<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lua Editor</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/editor/editor.main.min.css">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: #000;
    color: #fff;
    height: 100vh;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

.editor-container {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.tab-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: #000;
    border-bottom: 1px solid #1a1a1a;
}

.tab {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    background: #fff;
    color: #000;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
}

.tab.active {
    background: #ff9000;
    color: #000;
}

.tab-close {
    background: #000;
    color: #fff;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    text-align: center;
    line-height: 16px;
    font-size: 12px;
}

.new-tab-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: #1a1a1a;
    color: #ff9000;
    font-size: 18px;
    cursor: pointer;
}

.editor-wrapper {
    flex: 1;
    position: relative;
}

.editor-pane {
    position: absolute;
    inset: 0;
    opacity: 0;
    pointer-events: none;
}

.editor-pane.active {
    opacity: 1;
    pointer-events: all;
}
</style>
</head>

<body>
<div class="editor-container">
    <div class="tab-bar" id="tabBar">
        <button class="new-tab-btn" onclick="newFile()">+</button>
    </div>
    <div class="editor-wrapper" id="editorWrapper"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
<script>
let tabs = [];
let activeTabId = null;
let tabCounter = 0;

require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' } });

require(['vs/editor/editor.main'], () => {

    // ============================
    // PORNHUB THEME
    // ============================
    monaco.editor.defineTheme('pornhub', {
        base: 'vs-dark',
        inherit: true,
        rules: [
            { token: 'comment', foreground: '6b7280', fontStyle: 'italic' },
            { token: 'keyword', foreground: 'ff9000', fontStyle: 'bold' },
            { token: 'number', foreground: 'ffb347' },
            { token: 'string', foreground: 'ffffff' },
            { token: 'identifier', foreground: 'e5e5e5' },
            { token: 'type.identifier', foreground: 'ff9000' }
        ],
        colors: {
            'editor.background': '#000000',
            'editor.foreground': '#ffffff',
            'editorCursor.foreground': '#ff9000',
            'editor.selectionBackground': '#2a1a00',
            'editor.lineHighlightBackground': '#0d0d0d',
            'editorLineNumber.foreground': '#555555',
            'editorLineNumber.activeForeground': '#ff9000',
            'scrollbarSlider.background': '#1a1a1a',
            'scrollbarSlider.hoverBackground': '#ff900044'
        }
    });

    monaco.languages.register({ id: 'lua' });

    createNewTab();
});

function createNewTab(content = '') {
    const id = `tab-${tabCounter}`;
    const label = `Untitled ${tabCounter + 1}`;
    tabCounter++;

    const pane = document.createElement('div');
    pane.className = 'editor-pane';
    pane.id = id;
    document.getElementById('editorWrapper').appendChild(pane);

    const editor = monaco.editor.create(pane, {
        value: content,
        language: 'lua',
        theme: 'pornhub',
        automaticLayout: true,
        fontSize: 14,
        minimap: { enabled: false },
        cursorBlinking: 'smooth',
        smoothScrolling: true
    });

    tabs.push({ id, label, editor });
    switchTab(id);
    renderTabs();
}

function renderTabs() {
    const bar = document.getElementById('tabBar');
    bar.querySelectorAll('.tab').forEach(t => t.remove());

    tabs.forEach(tab => {
        const el = document.createElement('div');
        el.className = 'tab' + (tab.id === activeTabId ? ' active' : '');
        el.innerHTML = `
            <span>${tab.label}</span>
            <span class="tab-close" onclick="closeTab(event,'${tab.id}')">Ã—</span>
        `;
        el.onclick = () => switchTab(tab.id);
        bar.insertBefore(el, bar.lastElementChild);
    });
}

function switchTab(id) {
    activeTabId = id;
    tabs.forEach(t => {
        document.getElementById(t.id).classList.toggle('active', t.id === id);
    });
    renderTabs();
}

function closeTab(e, id) {
    e.stopPropagation();
    const i = tabs.findIndex(t => t.id === id);
    if (i === -1) return;

    tabs[i].editor.dispose();
    document.getElementById(id).remove();
    tabs.splice(i, 1);

    if (!tabs.length) createNewTab();
    else switchTab(tabs[Math.max(i - 1, 0)].id);
}

function newFile() {
    createNewTab();
}

// ==============================
// WEBVIEW BRIDGE
// ==============================
window.getActiveLuaCode = () => {
    const tab = tabs.find(t => t.id === activeTabId);
    return tab ? tab.editor.getValue() : "";
};

window.setActiveLuaCode = (code) => {
    const tab = tabs.find(t => t.id === activeTabId);
    if (tab) tab.editor.setValue(code || "");
};
</script>
</body>
</html>
